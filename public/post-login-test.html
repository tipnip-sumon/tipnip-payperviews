<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Post-Login Fix Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .success { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .warning { background: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .error { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        button {
            padding: 10px 20px;
            margin: 5px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-warning { background: #ffc107; color: #212529; }
        .btn-danger { background: #dc3545; color: white; }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üîß Post-Login Fix Test Suite</h1>
    
    <div class="test-section">
        <h2>üìç Current Page Status</h2>
        <div id="currentStatus"></div>
        <pre id="currentInfo"></pre>
    </div>
    
    <div class="test-section">
        <h2>üßπ URL Cleaning Test</h2>
        <button class="btn-warning" onclick="testProblematicURL()">Test with Problematic URL</button>
        <button class="btn-success" onclick="testURLCleaning()">Test URL Cleaning</button>
        <div id="urlTestResults"></div>
    </div>
    
    <div class="test-section">
        <h2>üîò Footer Button Test</h2>
        <button class="btn-primary" onclick="testFooterButtons()">Test Footer Modal Buttons</button>
        <button class="btn-success" onclick="ensureFooterWork()">Ensure Footer Buttons Work</button>
        <div id="footerTestResults"></div>
    </div>
    
    <div class="test-section">
        <h2>üö™ Logout Test</h2>
        <button class="btn-danger" onclick="testLogoutFunction()">Test Logout Function</button>
        <div id="logoutTestResults"></div>
    </div>
    
    <div class="test-section">
        <h2>üõ°Ô∏è Emergency Systems Status</h2>
        <button class="btn-primary" onclick="checkEmergencySystems()">Check All Emergency Systems</button>
        <div id="emergencySystemsStatus"></div>
    </div>

    <!-- Load our fix scripts -->
    <script src="emergency-loop-breaker.js"></script>
    <script src="post-login-fix.js"></script>
    <script src="dashboard-url-cleaner.js"></script>

    <script>
        // Display current status
        function updateCurrentStatus() {
            const info = {
                'Current URL': window.location.href,
                'Has Problematic Params': typeof PostLoginFix !== 'undefined' ? PostLoginFix.hasProblematicParameters() : 'PostLoginFix not loaded',
                'Dashboard URL Cleaner': typeof DashboardURLCleaner !== 'undefined' ? 'Loaded' : 'Not loaded',
                'Emergency Loop Breaker': typeof EmergencyLoopBreaker !== 'undefined' ? 'Loaded' : 'Not loaded',
                'User Agent': navigator.userAgent
            };
            
            document.getElementById('currentInfo').textContent = JSON.stringify(info, null, 2);
            
            let statusHTML = '';
            if (typeof PostLoginFix !== 'undefined') {
                statusHTML += '<div class="status success">‚úÖ Post-Login Fix loaded</div>';
            } else {
                statusHTML += '<div class="status error">‚ùå Post-Login Fix not loaded</div>';
            }
            
            if (typeof DashboardURLCleaner !== 'undefined') {
                statusHTML += '<div class="status success">‚úÖ Dashboard URL Cleaner loaded</div>';
            } else {
                statusHTML += '<div class="status error">‚ùå Dashboard URL Cleaner not loaded</div>';
            }
            
            document.getElementById('currentStatus').innerHTML = statusHTML;
        }

        function testProblematicURL() {
            const testURL = window.location.origin + window.location.pathname + '?cache_bust=1754763001885&device_switch=1&v=1.0.0&test=problematic';
            history.pushState(null, '', testURL);
            document.getElementById('urlTestResults').innerHTML = 
                '<div class="status warning">‚ö†Ô∏è Added problematic parameters to URL. Current URL: ' + window.location.href + '</div>';
        }

        function testURLCleaning() {
            if (typeof PostLoginFix !== 'undefined') {
                const cleaned = PostLoginFix.cleanURL();
                document.getElementById('urlTestResults').innerHTML = 
                    '<div class="status ' + (cleaned ? 'success' : 'warning') + '">' + 
                    (cleaned ? '‚úÖ URL cleaned successfully' : '‚ö†Ô∏è No cleaning needed') + 
                    '</div><div class="status">Current URL: ' + window.location.href + '</div>';
            } else {
                document.getElementById('urlTestResults').innerHTML = 
                    '<div class="status error">‚ùå PostLoginFix not available</div>';
            }
        }

        function testFooterButtons() {
            if (typeof PostLoginFix !== 'undefined') {
                PostLoginFix.ensureFooterButtonsWork();
                document.getElementById('footerTestResults').innerHTML = 
                    '<div class="status success">‚úÖ Footer button function called</div>';
            } else {
                document.getElementById('footerTestResults').innerHTML = 
                    '<div class="status error">‚ùå PostLoginFix not available</div>';
            }
        }

        function ensureFooterWork() {
            if (typeof PostLoginFix !== 'undefined') {
                PostLoginFix.createFallbackModalFunction();
                document.getElementById('footerTestResults').innerHTML = 
                    '<div class="status success">‚úÖ Fallback modal functions created</div>';
            } else {
                document.getElementById('footerTestResults').innerHTML = 
                    '<div class="status error">‚ùå PostLoginFix not available</div>';
            }
        }

        function testLogoutFunction() {
            if (typeof PostLoginFix !== 'undefined') {
                // Don't actually logout, just test if function exists
                const logoutWorks = typeof PostLoginFix.ensureLogoutWorks === 'function';
                document.getElementById('logoutTestResults').innerHTML = 
                    '<div class="status ' + (logoutWorks ? 'success' : 'error') + '">' + 
                    (logoutWorks ? '‚úÖ Logout function available' : '‚ùå Logout function not found') + 
                    '</div>';
            } else {
                document.getElementById('logoutTestResults').innerHTML = 
                    '<div class="status error">‚ùå PostLoginFix not available</div>';
            }
        }

        function checkEmergencySystems() {
            let status = '';
            
            // Check Emergency Loop Breaker
            if (typeof EmergencyLoopBreaker !== 'undefined') {
                status += '<div class="status success">‚úÖ Emergency Loop Breaker: Active</div>';
            } else {
                status += '<div class="status error">‚ùå Emergency Loop Breaker: Not loaded</div>';
            }
            
            // Check PostLoginFix
            if (typeof PostLoginFix !== 'undefined') {
                status += '<div class="status success">‚úÖ Post-Login Fix: Active</div>';
            } else {
                status += '<div class="status error">‚ùå Post-Login Fix: Not loaded</div>';
            }
            
            // Check Dashboard URL Cleaner
            if (typeof DashboardURLCleaner !== 'undefined') {
                status += '<div class="status success">‚úÖ Dashboard URL Cleaner: Active</div>';
            } else {
                status += '<div class="status error">‚ùå Dashboard URL Cleaner: Not loaded</div>';
            }
            
            document.getElementById('emergencySystemsStatus').innerHTML = status;
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            updateCurrentStatus();
        });

        // Update status when URL changes
        window.addEventListener('urlCleaned', function(event) {
            console.log('URL cleaned event received:', event.detail);
            updateCurrentStatus();
        });
    </script>
</body>
</html>
